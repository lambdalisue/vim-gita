Describe gita#features#diff_ls
  Before
    let gita = gita#get()
    let gita.git.cache.repository.clear()
    let operations_saved = deepcopy(gita.operations)

    function! gita.operations.diff(...) abort
      call add(self._previous_args, a:000)
      return {
            \ 'status': 0,
            \ 'stdout': join([
            \   '0   10   foo.md',
            \   '10  10   bar.md',
            \   '10  10   hoge.md',
            \ ], '\n'),
            \}
    endfunction
    let gita.operations._previous_args = []
  End

  After
    let gita.operations = operations_saved
    call WipeoutAll()
  End

  Context #open({options})
    It should open gita:diff-ls (monitor) window
      call gita#features#diff_ls#open({
            \ 'commit': 'HEAD',
            \})
      " It should call gita.operations.diff internally
      Assert Equals(gita.operations._previous_args[0], [{
            \ 'no_prefix': 1,
            \ 'no_color': 1,
            \ 'numstat': 1,
            \ 'commit': 'HEAD',
            \}, {
            \ 'echo': 'fail',
            \ 'force_update': 1,
            \}])
      Assert Equals(bufname('%'), 'gita:diff-ls:HEAD')
      Assert Equals(&modifiable, 0)
      Assert Equals(&readonly, 1)
    End
  End
End

